{"version":3,"sources":["starter/components/photoForm.cljs"],"mappings":"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","names":["starter.components.photoForm/emptyDescription","description","cljs.core._EQ_","cljs.core/deref","cljs.core/count","starter.components.photoForm/emptyPhoto","photo","starter.components.photoForm/submitPhoto","contractInstance","loading","open","details","cljs.core/reset!","cljs_ipfs_api.files.add","err","files","cljs.core.println","hash","js/JSON","obj26952","error","txHash","p__26954","map__26955","cljs.core/--destructure-map","cljs.core.get","starter.components.photoForm/photoForm","reagent.core.atom","cljs_ipfs_api.core.init_ipfs","p1__26953#","reagent-mui.material.modal/modal","reagent-mui.material.box/box","reagent-mui.material.typography/typography","uploaded","reagent-mui.material.icon-button/icon-button","reagent-mui.icons.add-a-photo-sharp/add-a-photo-sharp","reagent-mui.material.text-field/text-field","e","reagent-mui.material.button/button","or__4253__auto__","reagent-mui.material.circular-progress/circular-progress","cljs.core/not"],"sourcesContent":["(ns starter.components.photoForm\n  (:require\n    [reagent.core :as r]\n    [reagent-mui.material.modal :refer [modal]]\n    [reagent-mui.material.alert :refer [alert]]\n    [reagent-mui.material.box :refer [box]]\n    [reagent-mui.material.circular-progress :refer [circular-progress]]\n    [reagent-mui.material.typography :refer [typography]]\n    [reagent-mui.material.button :refer [button]]\n    [reagent-mui.material.icon-button :refer [icon-button]]\n    [reagent-mui.icons.add-a-photo-sharp :refer [add-a-photo-sharp]]\n    [reagent-mui.material.text-field :refer [text-field]]\n    [starter.components.errorMessage :refer [errorMessage]]\n    [cljs-ipfs-api.core :as icore :refer [init-ipfs]]\n    [cljs-ipfs-api.files :as ifiles]\n))\n\n(defn emptyDescription [description]\n  (= (count @description) 0)\n)\n\n(defn emptyPhoto [photo]\n  (nil? @photo)\n)\n\n(defn submitPhoto [photo description contractInstance loading open details]\n  (do \n    (reset! loading true)\n    (ifiles/add @photo\n      (fn [err files]\n        (if err\n          (println (str \"err: \" err))\n          (let [hash (. (. js/JSON parse files) -Hash)]\n            (. ^js (. (. contractInstance -methods) setPicture hash @description) send (js-obj \"from\" (:account @details)) \n              (fn [error txHash] ;; callback\n                (if error \n                  (println error) \n                  (do \n                    (reset! loading false)\n                    (reset! open false)\n                  )\n                )\n              )\n            )\n          )\n        )\n      )\n    )\n  )\n)\n\n(defn photoForm [{:keys [open contractInstance details]}] \n  (let [photo (r/atom nil) description (r/atom nil) error (r/atom nil) loading (r/atom false)]\n    (do\n      (init-ipfs {:host \"https://ipfs.infura.io:5001\"})\n      (fn []\n        [:<>\n          [modal\n            {:open @open\n              :on-close #(do (reset! photo nil) (reset! description nil) (reset! open false))}\n            [box \n              {:sx {:box-shadow \"20\" \n                    :background-color \"#CAF0F8\"\n                    :padding \"30px\"\n                    :height \"350px\"\n                    :width \"400px\"\n                    :position \"absolute\"\n                    :top \"50%\"\n                    :left \"50%\"\n                    :transform \"translate(-50%, -50%)\"\n                    :border \"5px solid #5F939A\"\n                    :display \"flex\"\n                    :flex-direction \"column\"\n                    :align-items \"center\"}}\n              [typography\n                {:variant \"h6\"\n                  :component \"div\"\n                  :sx {:color \"#070707\"\n                        :font-weight \"100\"}}\n                \"Step 1: upload a photo\"]\n              [:hr\n                {:style {:width \"50%\"}}]\n              [:div\n                {:style {:display \"flex\"\n                          :flex-direction \"column\"\n                          :align-items \"center\"}}\n                [:label \n                  {:html-for \"upload-image\"}\n                  [:input \n                    {:accept \"image/*\"\n                      :id \"upload-image\"\n                      :type \"file\"\n                      :style {:display \"none\"}\n                      :on-change #(let [uploaded (-> % .-target .-files (aget 0))] (reset! photo uploaded))}]\n                  [icon-button \n                    {:component \"span\"}\n                    [add-a-photo-sharp]]]\n                [typography\n                  {:variant \"h6\"\n                    :component \"div\"\n                    :sx {:color (if (emptyPhoto photo)  \"#d32f2f\" \"#070707\")\n                          :font-size \"12px\"\n                          :font-weight \"500\"}}\n                  (if (emptyPhoto photo) \"no photo uploaded\" (.-name @photo))]\n              ]\n              [:div \n                {:style {:margin \"10px\"}}]\n              [typography\n                {:variant \"h6\"\n                  :component \"div\"\n                  :sx {:color \"#070707\"\n                        :font-weight \"100\"}}\n                \"Step 2: add a decription to your photo\"]\n              [:hr\n                {:style {:margin \"10px\"\n                          :width \"50%\"}}]\n              [:div\n                {:style {:height \"120px\"}}\n              [text-field\n                {:multiline true \n                  :rows 2\n                  :error (emptyDescription description)\n                  :helper-text (when (emptyDescription description) \"description cannot be empty\")\n                  :value @description\n                  :on-change (fn [e] (reset! description (.. e -target -value)))}]\n              ]\n              [:div \n                {:style {:margin \"10px\"}}]\n              [button \n                {:variant \"contained\"\n                  :disabled (or (emptyDescription description) (emptyPhoto photo) @loading)\n                  :disable-elevation true\n                  :on-click #(submitPhoto photo description contractInstance loading open details)}\n                \"Submit\"]\n              [circular-progress {:sx {:margin \"10px\" :visibility (when (not @loading) \"hidden\")}}]\n            ]\n          ]\n        ]\n      )\n    )\n  )\n)"]}